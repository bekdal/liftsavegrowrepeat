<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mortgage vs Investment Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 40px; }
        h2 { border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-top: 0; color: #34495e; }
        
        /* Layout */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        
        .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        /* Specific Styles for Comparison Section */
        .comparison-section { background: #fff; border-top: 5px solid #8e44ad; margin-top: 40px; }
        .comparison-result { font-size: 1.4em; text-align: center; margin: 20px 0; padding: 20px; border-radius: 8px; font-weight: bold; }
        .win-invest { background-color: #e8f8f5; color: #27ae60; border: 1px solid #27ae60; }
        .win-mortgage { background-color: #fdedec; color: #c0392b; border: 1px solid #c0392b; }

        /* Inputs */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9em; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        
        .btn-calc { background-color: #3498db; color: white; border: none; padding: 12px; width: 100%; border-radius: 4px; cursor: pointer; font-size: 1em; margin-top: 10px; transition: 0.2s; }
        .btn-calc:hover { background-color: #2980b9; }
        .btn-compare { background-color: #8e44ad; }
        .btn-compare:hover { background-color: #732d91; }

        /* Outputs */
        .result-box { margin-top: 20px; padding: 15px; background: #e8f6f3; border-radius: 4px; text-align: center; font-size: 1.2em; font-weight: bold; color: #16a085; }
        
        /* Tables */
        .table-container { margin-top: 20px; overflow-x: auto; max-height: 300px; overflow-y: auto; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
        th, td { text-align: right; padding: 10px; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; position: sticky; top: 0; text-align: right; }
        
        /* Table Footer Styling for Totals */
        tfoot th { 
            background-color: #ecf0f1; 
            border-top: 3px solid #bdc3c7; 
            font-weight: bold;
            color: #2c3e50;
        }
        
        /* Email Button */
        .suggestion-box { text-align: center; margin-top: 50px; padding: 20px; border-top: 1px solid #eee; }
        .btn-email { background-color: #95a5a6; color: white; text-decoration: none; padding: 10px 20px; border-radius: 20px; transition: 0.3s; display: inline-block; }
        .btn-email:hover { background-color: #7f8c8d; }
    </style>
</head>
<body>

<div class="container">
    <h1>Extra Mortgage Repayments Vs Share Portfolio</h1>

    <div class="grid">
        <div class="card">
            <h2>üè† Mortgage Calculator</h2>
            <div class="form-group">
                <label>Current Balance ($)</label>
                <input type="number" id="m_balance" value="500000">
            </div>
            <div class="form-group">
                <label>Interest Rate (%)</label>
                <input type="number" id="m_rate" value="6.0" step="0.01">
            </div>
            <div class="form-group">
                <label>Repayment Frequency</label>
                <select id="m_freq">
                    <option value="12">Monthly</option>
                    <option value="26">Fortnightly</option>
                </select>
            </div>
            <div class="form-group">
                <label>Total Repayment Amount</label>
                <input type="number" id="m_payment" value="3500">
            </div>
            <button class="btn-calc" onclick="calculateMortgage()">Calculate Mortgage</button>
            <div id="m_result" class="result-box" style="display:none;"></div>
            <canvas id="mortgageChart" style="margin-top:20px;"></canvas>
             <div class="table-container">
                <table id="m_table">
                    <thead><tr><th>Year</th><th>Open</th><th>Payment</th><th>Interest</th><th>Close</th></tr></thead>
                    <tbody></tbody>
                    <tfoot></tfoot> </table>
            </div>
        </div>

        <div class="card">
            <h2>üìà Share Investment</h2>
            <div class="form-group">
                <label>Initial Balance ($)</label>
                <input type="number" id="i_balance" value="10000">
            </div>
            <div class="form-group">
                <label>Contribution Amount ($)</label>
                <input type="number" id="i_contribution" value="1000">
            </div>
            <div class="form-group">
                <label>Contribution Frequency</label>
                <select id="i_freq">
                    <option value="12">Monthly</option>
                    <option value="26">Fortnightly</option>
                    <option value="1">Annually</option>
                </select>
            </div>
            <div class="grid" style="margin-bottom:0; gap:10px;">
                <div class="form-group">
                    <label>Growth %</label>
                    <input type="number" id="i_growth" value="5" step="0.1">
                </div>
                <div class="form-group">
                    <label>Yield %</label>
                    <input type="number" id="i_yield" value="3" step="0.1">
                </div>
            </div>
            <div class="form-group">
                 <label>Holding Period (Years)</label>
                 <input type="number" id="i_years" value="10">
            </div>
             <div class="grid" style="margin-bottom:0; gap:10px;">
                <div class="form-group">
                    <label>Reinvest Divs?</label>
                    <select id="i_reinvest"><option value="yes">Yes</option><option value="no">No</option></select>
                </div>
                <div class="form-group">
                    <label>Tax Bracket (%)</label>
                    <input type="number" id="i_tax" value="30" step="0.1">
                </div>
            </div>
            <button class="btn-calc" onclick="calculateInvestment()">Calculate Shares</button>
            <div id="i_result" class="result-box" style="display:none;"></div>
            <canvas id="investmentChart" style="margin-top:20px;"></canvas>
            <div class="table-container">
                <table id="i_table">
                    <thead><tr><th>Year</th><th>Open</th><th>Contrib</th><th>Return</th><th>Tax</th><th>Close</th></tr></thead>
                    <tbody></tbody>
                    <tfoot></tfoot> </table>
            </div>
        </div>
    </div>

    <div class="card comparison-section">
        <h2>‚öñÔ∏è Compare: The "Extra Money" Test</h2>
        <p>If you had an <strong>extra amount</strong> of money every month, where should it go?</p>
        
        <div class="grid" style="margin-bottom: 20px;">
            <div class="form-group">
                <label>Extra Amount Available (Monthly) ($)</label>
                <input type="number" id="c_extra" value="500">
            </div>
            <div class="form-group">
                <label>Timeframe to Compare (Years)</label>
                <input type="number" id="c_years" value="10">
            </div>
        </div>

        <button class="btn-calc btn-compare" onclick="runComparison()">Run Comparison</button>
        
        <div id="c_result_box" style="display:none;">
            <div id="c_winner_text" class="comparison-result"></div>
            
            <div class="grid">
                <div>
                    <h3>Scenario A: Into Mortgage</h3>
                    <p>By adding this extra amount to your mortgage repayment, you save:</p>
                    <div id="c_mortgage_saved" style="font-size:1.5em; font-weight:bold; color:#c0392b;">$0</div>
                    <small>In interest costs over the timeframe</small>
                </div>
                <div>
                    <h3>Scenario B: Into Shares</h3>
                    <p>By investing this extra amount (starting from $0 balance), you gain:</p>
                    <div id="c_invest_gained" style="font-size:1.5em; font-weight:bold; color:#27ae60;">$0</div>
                    <small>Total Profit (Growth + Yield - Tax)</small>
                </div>
            </div>
        </div>
    </div>

    <div class="suggestion-box">
        <a href="mailto:ben.rekdale@gmail.com?subject=Calculator%20Suggestion" class="btn-email">‚úâÔ∏è Leave or Request a Suggestion</a>
    </div>

</div>

<script>
    // --- UTILITY ---
    const formatCurrency = (num) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(num);
    let mChart = null;
    let iChart = null;

    // --- MORTGAGE LOGIC ---
    function calculateMortgage() {
        const balanceStart = parseFloat(document.getElementById('m_balance').value);
        const rate = parseFloat(document.getElementById('m_rate').value) / 100;
        const freq = parseInt(document.getElementById('m_freq').value);
        const payment = parseFloat(document.getElementById('m_payment').value);
        
        const minInterest = (balanceStart * rate) / freq;
        if (payment <= minInterest) {
            alert(`Payment too low! Must be > ${formatCurrency(minInterest)}`);
            return;
        }

        let balance = balanceStart;
        let chartLabels = [];
        let dataBalance = [], dataPrincipal = [], dataInterest = [];
        let yearlyData = [];
        let curYear = { interest: 0, payment: 0, principal: 0 };
        let periods = 0, years = 0;
        let totalInterestPaid = 0; // Total accumulation variable

        while (balance > 0 && periods < 1200) {
            periods++;
            const interest = (balance * rate) / freq;
            let principal = payment - interest;
            if (balance < principal) principal = balance;
            
            balance -= principal;
            totalInterestPaid += interest; // Accumulate total interest
            curYear.interest += interest;
            curYear.payment += (principal + interest);
            curYear.principal += principal; // Total principal paid in this year

            if (periods % freq === 0 || balance <= 0) {
                years++;
                chartLabels.push(`Year ${years}`);
                dataBalance.push(balance);
                dataInterest.push(curYear.interest);
                dataPrincipal.push(curYear.payment);
                
                yearlyData.push({ y: years, o: (balance + curYear.principal), p: curYear.payment, i: curYear.interest, c: balance });
                curYear = { interest: 0, payment: 0, principal: 0 };
            }
        }
        
        // Final balance for display purposes (should be 0 or near 0)
        if (balance < 0) balance = 0;

        document.getElementById('m_result').style.display = 'block';
        document.getElementById('m_result').innerText = `Repayment Time: ${(periods / freq).toFixed(1)} Years`;

        const tbody = document.querySelector('#m_table tbody');
        const tfoot = document.querySelector('#m_table tfoot');
        tbody.innerHTML = '';
        
        // Populate Body
        yearlyData.forEach(r => {
            tbody.innerHTML += `<tr><td>${r.y}</td><td>${formatCurrency(r.o)}</td><td>${formatCurrency(r.p)}</td><td>${formatCurrency(r.i)}</td><td>${formatCurrency(r.c)}</td></tr>`;
        });
        
        // Populate Footer (Totals)
        const totalPayments = yearlyData.reduce((acc, row) => acc + row.p, 0);
        tfoot.innerHTML = `<tr>
            <th>TOTALS</th>
            <th></th>
            <th>${formatCurrency(totalPayments)}</th>
            <th>${formatCurrency(totalInterestPaid)}</th>
            <th>${formatCurrency(balance)}</th>
        </tr>`;

        renderChart('mortgageChart', mChart, chartLabels, 
            [{ label: 'Balance', data: dataBalance, borderColor: '#e74c3c' },
             { label: 'Annual Interest', data: dataInterest, borderColor: '#f1c40f' }], 
             (c) => mChart = c);
    }

    // --- INVESTMENT LOGIC ---
    function calculateInvestment() {
        let balance = parseFloat(document.getElementById('i_balance').value);
        const contribution = parseFloat(document.getElementById('i_contribution').value);
        const freq = parseInt(document.getElementById('i_freq').value);
        const years = parseInt(document.getElementById('i_years').value);
        const growthRate = parseFloat(document.getElementById('i_growth').value) / 100;
        const yieldRate = parseFloat(document.getElementById('i_yield').value) / 100;
        const reinvest = document.getElementById('i_reinvest').value === 'yes';
        const taxRate = parseFloat(document.getElementById('i_tax').value) / 100;

        let chartLabels = [], dataBalance = [], dataContrib = [], dataReturn = [];
        let overallTotalReturn = 0;
        let overallTotalTax = 0;
        let overallTotalContrib = 0;
        
        const tbody = document.querySelector('#i_table tbody');
        const tfoot = document.querySelector('#i_table tfoot');
        tbody.innerHTML = '';

        for (let y = 1; y <= years; y++) {
            let startBal = balance;
            let yearContrib = 0;
            let yearGrowth = 0;

            for (let p = 0; p < freq; p++) {
                balance += contribution;
                yearContrib += contribution;
                let periodGrowth = balance * (growthRate / freq);
                balance += periodGrowth;
                yearGrowth += periodGrowth;
            }
            
            let yearYield = balance * yieldRate; 
            let taxExpense = yearYield * taxRate;
            let totalReturn = yearGrowth + yearYield;

            if (reinvest) balance += yearYield; 

            overallTotalReturn += totalReturn;
            overallTotalTax += taxExpense;
            overallTotalContrib += yearContrib;
            
            chartLabels.push(`Year ${y}`);
            dataBalance.push(balance);
            dataContrib.push(yearContrib);
            dataReturn.push(totalReturn);

            tbody.innerHTML += `<tr><td>${y}</td><td>${formatCurrency(startBal)}</td><td>${formatCurrency(yearContrib)}</td><td>${formatCurrency(totalReturn)}</td><td>${formatCurrency(taxExpense)}</td><td>${formatCurrency(balance)}</td></tr>`;
        }
        
        // Populate Footer (Totals)
        tfoot.innerHTML = `<tr>
            <th>TOTALS</th>
            <th>${formatCurrency(parseFloat(document.getElementById('i_balance').value))}</th>
            <th>${formatCurrency(overallTotalContrib)}</th>
            <th>${formatCurrency(overallTotalReturn)}</th>
            <th>${formatCurrency(overallTotalTax)}</th>
            <th>${formatCurrency(balance)}</th>
        </tr>`;


        document.getElementById('i_result').style.display = 'block';
        document.getElementById('i_result').innerText = `Final Balance: ${formatCurrency(balance)}`;
        
        renderChart('investmentChart', iChart, chartLabels, 
            [{ label: 'Balance', data: dataBalance, borderColor: '#2ecc71' },
             { label: 'Annual Return', data: dataReturn, borderColor: '#f1c40f' }], 
             (c) => iChart = c);
    }

    // --- COMPARISON LOGIC ---
    function runComparison() {
        const extra = parseFloat(document.getElementById('c_extra').value);
        const years = parseInt(document.getElementById('c_years').value);
        
        // 1. MORTGAGE SAVING CALC
        const mBalance = parseFloat(document.getElementById('m_balance').value);
        const mRate = parseFloat(document.getElementById('m_rate').value) / 100;
        
        // The comparison needs a baseline repayment to work against. We assume the user's current payment is the baseline.
        const basePayment = parseFloat(document.getElementById('m_payment').value);
        const mFreq = parseInt(document.getElementById('m_freq').value);

        // Normalize base payment to monthly for 12 periods/year
        let baseMonthlyPayment;
        if (mFreq === 26) {
             baseMonthlyPayment = basePayment * (26 / 12); // Convert fortnightly payments to rough monthly equivalent for simplicity
        } else {
             baseMonthlyPayment = basePayment;
        }

        const interestPaidStandard = getInterestOverTime(mBalance, mRate, baseMonthlyPayment, 0, years);
        const interestPaidWithExtra = getInterestOverTime(mBalance, mRate, baseMonthlyPayment, extra, years);
        
        const interestSaved = interestPaidStandard - interestPaidWithExtra;

        // 2. INVESTMENT GAIN CALC
        const iGrowth = parseFloat(document.getElementById('i_growth').value) / 100;
        const iYield = parseFloat(document.getElementById('i_yield').value) / 100;
        const iTax = parseFloat(document.getElementById('i_tax').value) / 100;
        const iReinvest = document.getElementById('i_reinvest').value === 'yes';

        let invBalance = 0;
        let totalInvested = 0;
        
        for(let y=0; y<years; y++) {
            for(let m=0; m<12; m++) {
                invBalance += extra;
                totalInvested += extra;
                invBalance += invBalance * (iGrowth/12);
            }
            let yrYield = invBalance * iYield;
            let yrTax = yrYield * iTax; 
            
            if(iReinvest) invBalance += yrYield;
            invBalance -= yrTax; // Tax acts as a cash drag/cost
        }
        
        const investmentProfit = invBalance - totalInvested;

        // 3. DISPLAY
        document.getElementById('c_result_box').style.display = 'block';
        document.getElementById('c_mortgage_saved').innerText = formatCurrency(interestSaved);
        document.getElementById('c_invest_gained').innerText = formatCurrency(investmentProfit);

        const diff = investmentProfit - interestSaved;
        const winnerDiv = document.getElementById('c_winner_text');
        
        if (diff > 0) {
            winnerDiv.innerText = `Investing wins by ${formatCurrency(diff)}`;
            winnerDiv.className = "comparison-result win-invest";
        } else {
            winnerDiv.innerText = `Paying Mortgage wins by ${formatCurrency(Math.abs(diff))}`;
            winnerDiv.className = "comparison-result win-mortgage";
        }
    }

    function getInterestOverTime(bal, rate, basePayment, extraPayment, years) {
        let totalInterest = 0;
        const monthlyPayment = basePayment + extraPayment;

        for(let i=0; i < years * 12; i++) {
            if(bal <= 0) break;
            let interest = (bal * rate) / 12;
            totalInterest += interest;
            let principal = monthlyPayment - interest;
            if (bal < principal) principal = bal;
            bal -= principal;
        }
        return totalInterest;
    }

    function renderChart(id, chart, labels, datasets, setChart) {
        if (chart) chart.destroy();
        const ctx = document.getElementById(id).getContext('2d');
        const newChart = new Chart(ctx, {
            type: 'line',
            data: { labels: labels, datasets: datasets.map(d => ({ ...d, tension:0.3, pointRadius:1, borderWidth:2, fill:false })) },
            options: { responsive: true, interaction: { mode: 'index', intersect: false }, scales: { y: { beginAtZero: true } } }
        });
        setChart(newChart);
    }
    
    window.onload = function() { calculateMortgage(); calculateInvestment(); }
</script>
</body>
</html>
